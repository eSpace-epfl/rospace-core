<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<launch>
    <!-- Check if target coordinates type defined -->
    <!-- mode can be: "absolute" or "relative" -->
    <arg name="prop_mode" default="absolute" />

    <arg name="ns_chaser" default="chaser" />
    <arg name="ns_target" default="target" />

    <arg name="record_bag" default="False" />
    <rosparam if="$(arg record_bag)" param="start_running">True</rosparam>


    <!-- Load simulation world -->
	<param name="robot_description" textfile="$(find rospace_simulator)/res/models/world.urdf" />
    <!-- use simulation time -->
    <!-- has to be set here otherwise library not setting wall time to zero -->
    <param name="/use_sim_time" value="True" />

    <!-- Launch CSO & target propagator -->
    <include file="$(find rospace_propagator)/launch/$(arg prop_mode)_orbit.launch">
        <arg name="ns_chaser" value="$(arg ns_chaser)" />
        <arg name="ns_target" value="$(arg ns_target)" />
    </include>

    <!-- Launch spacecraft specific nodes and parameters -->
    <group ns="$(arg ns_chaser)">
        <!-- Load Configuration File for sensors etc -->
        <rosparam command="load" file="$(find rospace_simulator)/cfg/$(arg ns_chaser).yaml" />

        <group ns="sensors">
            <!-- Launch IMU -->
            <include file="$(find rospace_imu)/launch/imu.launch">
                <arg name="spacecraft" value="$(arg ns_chaser)" />
            </include>
        </group>

        <group ns="actuators">
            <!-- Launch Magnetorquer -->
            <include file="$(find rospace_magnetorquer)/launch/magnetorquer.launch">
                <arg name="spacecraft" value="$(arg ns_chaser)"/>
            </include>
        </group>
        
    </group>

    <group ns="$(arg ns_target)">
        <!-- Load Configuration File for sensors etc -->
        <rosparam command="load" file="$(find rospace_simulator)/cfg/$(arg ns_target).yaml" />

        <group ns="Sensors">
        <!-- Launch IMU -->
            <include file="$(find rospace_imu)/launch/imu.launch">
                <arg name="spacecraft" value="$(arg ns_target)" />
            </include>
        </group>
    </group>


    <!-- Include CSO base definition -->
    <include file="$(find rospace_simulator)/launch/cso_base.launch">
        <arg name="ns_chaser" value="$(arg ns_chaser)" />
        <arg name="ns_target" value="$(arg ns_target)" />
    </include>

    <!-- Include TF publishers -->
    <include file="$(find rospace_simulator)/launch/tf_publisher_absolute.launch">
        <arg name="ns_chaser" value="$(arg ns_chaser)" />
        <arg name="ns_target" value="$(arg ns_target)" />
    </include>

    <!-- start rviz -->
    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find rospace_simulator)/res/rviz/tf_large.rviz" required="false" />


     <!-- Launch Visualizer -->
    <node name="rqt_sc" pkg="rqt_simtime_plugin" type="rqt_simtime_plugin" />

    <include if="$(arg record_bag)" file="$(find rospace_simulator)/launch/record_bag.launch" />

</launch>
